<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
      <meta name="robots" content="noindex">

    <title>Cloud Platform Overview | Cloud Platform User Guide</title>

    <!--[if gt IE 8]><!--><link href="/stylesheets/screen.css" rel="stylesheet" media="screen" /><!--<![endif]-->
    <!--[if lte IE 8]><link href="/stylesheets/screen-old-ie.css" rel="stylesheet" media="screen" /><![endif]-->

    <link rel="canonical" href="https://user-guide.cloud-platform.service.justice.gov.uk/documentation/concepts/cp-overview.html">


    <link href="/stylesheets/print.css" rel="stylesheet" media="print" />
    <script src="/javascripts/application.js"></script>

      <meta property="og:image" content="https://user-guide.cloud-platform.service.justice.gov.uk/images/govuk-large.png" />
      <meta property="og:site_name" content="Cloud Platform User Guide" />
      <meta property="og:title" content="Cloud Platform Overview" />
      <meta property="og:type" content="object" />
      <meta property="og:url" content="https://user-guide.cloud-platform.service.justice.gov.uk/documentation/concepts/cp-overview.html" />
      <meta property="twitter:card" content="summary" />
      <meta property="twitter:domain" content="user-guide.cloud-platform.service.justice.gov.uk" />
      <meta property="twitter:image" content="https://user-guide.cloud-platform.service.justice.gov.uk/images/govuk-large.png" />
      <meta property="twitter:title" content="Cloud Platform Overview | Cloud Platform User Guide" />
      <meta property="twitter:url" content="https://user-guide.cloud-platform.service.justice.gov.uk/documentation/concepts/cp-overview.html" />

    
  </head>

  <body>
    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="skip-link">Skip to main content</a>

        <header class="header header--full-width">
  <div class="header__container">
    <div class="header__brand">
        <a href="/">
        <span class="header__title">
          Cloud Platform User Guide
            <span class="phase-banner">INTERNAL</span>
        </span>
        </a>
    </div>

      <div data-module="navigation">
        <button type="button" class="header__navigation-toggle js-nav-toggle" aria-controls="navigation" aria-label="Show or hide top level navigation">Menu</button>

        <nav id="navigation" class="header__navigation js-nav" aria-label="Top Level Navigation" aria-hidden="true">
          <ul>
              <li>
                <a href="mailto:platforms+user-guide@digital.justice.gov.uk?subject=User+guide+feedback">Feedback / Report a problem</a>
              </li>
              <li>
                <a href="/">Documentation</a>
              </li>
              <li>
                <a href="https://github.com/ministryofjustice/cloud-platform-user-guide">GitHub</a>
              </li>
          </ul>
        </nav>
      </div>
  </div>
</header>

      </div>

        <div id="toc-heading" class="toc-show fixedsticky">
          <a href="#toc" class="toc-show__label js-toc-show" aria-controls="toc">
            Table of contents <span class="toc-show__icon"></span>
          </a>
        </div>

      <div class="app-pane__body" data-module="in-page-navigation">
          <div class="app-pane__toc">
            <div class="toc" data-module="table-of-contents">
              <div class="search" data-module="search">
  <form action="https://www.google.co.uk/search" method="get" role="search">
    <input type="hidden" name="as_sitesearch" value="https://user-guide.cloud-platform.service.justice.gov.uk"/>
    <label for="search"  class="search__label">Search (via Google)</label>
    <input type="text" id="search" name="q" placeholder="Search" aria-controls="search-results" class="form-control" />
  </form>
  <div id="search-results" class="search-results" aria-hidden="true" role="dialog" aria-labelledby="search-results-title">
    <div class="search-results__inner">
      <button class="search-results__close">Close<span class="search-results__close-label"> search results</span></button>
      <h2 id="search-results-title" class="search-results__title" aria-live="polite">Results</h2>
      <div class="search-results__content"></div>
    </div>
  </div>
</div>

              <a href="#" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></a>
              <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading">
                      <ul>
  <li>
    <a href="#cloud-platform-overview">Cloud Platform Overview</a>
    <ul>
      <li>
        <a href="#where-your-code-runs">Where your code runs</a>
      </li>
      <li>
        <a href="#your-namespace-s">Your namespace(s)</a>
        <ul>
          <li>
            <a href="#aws-resources">AWS resources</a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#how-your-code-gets-to-the-cluster">How your code gets to the cluster</a>
      </li>
      <li>
        <a href="#typical-workflow">Typical Workflow</a>
      </li>
    </ul>
  </li>
</ul>


              </nav>
            </div>
          </div>

        <div class="app-pane__content toc-open-disabled">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
              <h1 id="cloud-platform-overview">Cloud Platform Overview</h1><p>The Cloud Platform (CP) is a <a href="https://kubernetes.io">kubernetes</a> cluster, running in the &ldquo;moj-cp&rdquo; <a href="https://aws.amazon.com/">Amazon AWS</a> account, inside a <a href="https://aws.amazon.com/vpc/">Virtual Private Cloud (VPC)</a> which isolates the cluster and the AWS resources used by services running in the cluster.</p>
<p><a href="/images/cp-vpc-diagram.png" target="_blank" rel="noopener noreferrer"><img src="/images/cp-vpc-diagram.png" alt="Cloud Platform Diagram" /></a></p>
<h2 id="where-your-code-runs">Where your code runs</h2><p>Within the cluster, services are isolated in <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/">namespaces</a>, inside which <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">deployments</a> consist of one or more <a href="https://www.docker.com/resources/what-container">docker containers</a>. The code you write will run inside those containers.</p>
<h2 id="your-namespace-s">Your namespace(s)</h2><p>A namespace is like a &ldquo;fenced off&rdquo; portion of the cluster. Your service runs inside one or more namespaces, and only your team has access to those namespaces. Access is controlled via membership in a specific github team within the MoJ github organisation, e.g. <a href="https://github.com/orgs/ministryofjustice/teams/prisoner-money">prisoner-money</a>)</p>
<p>All namespaces are defined in the <a href="https://github.com/ministryofjustice/cloud-platform-environments">Cloud Platform Environments repository</a>. Follow <a href="https://user-guide.cloud-platform.service.justice.gov.uk/documentation/getting-started/env-create.html#creating-a-cloud-platform-environment">this guide</a> to create a new namespace. To modify an existing namespace, you need to raise a PR with the relevant changes, and a member of the Cloud Platform team will review it for you.</p>
<h3 id="aws-resources">AWS resources</h3><p>The namespaces are defined in kubernetes YAML files. There is also a <code>resources</code> directory inside each namespace directory. This contains <a href="https://www.terraform.io/">terraform</a> code which defines any AWS resources (e.g. an <a href="https://aws.amazon.com/rds/">RDS database</a>) that your namespace requires.</p>
<p>Typically, creating an AWS resource will also add <a href="https://user-guide.cloud-platform.service.justice.gov.uk/documentation/deploying-an-app/add-secrets-to-deployment.html#adding-a-secret-to-an-application">secrets</a> to your namespace, containing the access credentials required to use that resource.</p>
<h2 id="how-your-code-gets-to-the-cluster">How your code gets to the cluster</h2><p>To deploy code to the CP, you will update a local YAML file which defines your deployment, and change the reference to your docker image.</p>
<p><a href="/images/cp-deploy-diagram.png" target="_blank" rel="noopener noreferrer"><img src="/images/cp-deploy-diagram.png" alt="Deploy Diagram" /></a></p>
<p>e.g. you might change that reference from <code>ministryofjustice/my-application:1.3</code> to <code>ministryofjustice/my-application:1.4</code> and then apply the new definition to the cluster.</p>
<p>As soon as you do this, the cluster will recognise that the container which is currently running <code>ministryofjustice/my-application:1.3</code> is no longer the correct version, and will launch a new instance of <code>ministryofjustice/my-application:1.4</code> and delete the old one.</p>
<h2 id="typical-workflow">Typical Workflow</h2>
<ol>
<li>Develop code in your local environment, and raise PRs in your team&rsquo;s Github repositories</li>
<li>Review and merge PR</li>
<li>On merge, your CI/CD pipeline (e.g. CircleCI):

<ol>
<li>creates docker image(s) from your code</li>
<li>tags and pushes docker images to your docker repository (e.g. ECR or Docker Hub)</li>
<li>updates your kubernetes yaml files (usually also in github) with new image tag values (this may be a manual step)</li>
</ol></li>
<li>Code is now ready to deploy to the cluster by using <code>kubectl apply</code> to apply the updated yaml file to the cluster (this may also be done via a CD pipeline)</li>
<li>Kubernetes recognises that the state of the cluster (specifically, your namespace) doesn&rsquo;t match the desired state defined in your yaml files, and makes whatever changes are required (e.g. launches pods running your new docker image, and shuts down any pods running the old version)</li>
</ol>


              <div data-module='page-expiry' data-last-reviewed-on="2020-09-02">
    <div class='page-expiry--not-expired'>
      This page was last reviewed on 2 June 2020.

        It needs to be reviewed again on 2 September 2020
.
    </div>

    <div class='page-expiry--expired'>
      This page was set to be reviewed before 2 September 2020.
      This might mean the content is out of date.
    </div>
  </div>

          </main>

            <ul class="contribution-banner">
              <li><a href="https://github.com/ministryofjustice/cloud-platform-user-guide/blob/master/source/documentation/concepts/cp-overview.html.md.erb">View source</a></li>
              <li><a href="https://github.com/ministryofjustice/cloud-platform-user-guide/issues/new?labels=bug&amp;title=Re:%20'Cloud%20Platform%20Overview'&amp;body=Problem%20with%20'Cloud%20Platform%20Overview'%20(https://user-guide.cloud-platform.service.justice.gov.uk/documentation/concepts/cp-overview.html)">Report problem</a></li>
              <li><a href="https://github.com/ministryofjustice/cloud-platform-user-guide">GitHub Repo</a></li>
            </ul>

          <footer class="footer">
  <div class="footer__licence">
    <a class="footer__licence-logo" href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" rel="license">Open Government Licence</a>
    <p class="footer__licence-description">All content is available under the <a href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" rel="license">Open Government Licence v3.0</a>, except where otherwise stated</p>
  </div>

  <div class="footer__copyright">
    <a class="footer__copyright-logo" href="http://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/copyright-and-re-use/crown-copyright/">© Crown copyright</a>
  </div>
</footer>

        </div>
      </div>
    </div>

    
  </body>
</html>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-138188246-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-138188246-1');
</script>

<script>
  // Add the current window.location to the body of the
  // feedback email message.
  function sendFeedback(mailto, event) {
    event.preventDefault();

    var body = "Feedback/Problem on page: " + window.location + "\n";
    var href = mailto + '&body=' + encodeURIComponent(body);

    window.location = href;
  }

  $(document).ready(function() {
    var feedbackLink = $('a[href^="mailto:"]:contains("Feedback")')[0];
    var mailto = feedbackLink.href;
    $(feedbackLink).on('click', function(event) { sendFeedback(mailto, event); });
  });
</script>
